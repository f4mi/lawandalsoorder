<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Law but also Order</title>
    <style>
        body {
            background: black;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Friz Quadrata', 'Friz Quadrata BT', 'FrizQuadrata', serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .law-order-container {
            text-align: center;
            font-size: 80px;
            color: white;
            font-weight: bold;
        }
        .law-order-top, .law-order-bottom {
            cursor: pointer;
        }
        .law-order-top {
            text-shadow:
                -6.3px -0.55125px 2px rgba(0,0,0,1),
                0 0 10px rgba(0,0,255,1),
                0 0 20px rgba(0,0,255,0.8),
                0 0 30px rgba(0,0,255,0.6),
                0 0 40px rgba(0,0,255,0.4);
            display: inline-block;
            margin-bottom: 10px;
        }
        .law-order-bottom {
            text-shadow:
                -6.3px -0.55125px 2px rgba(0,0,0,1),
                0 0 10px rgba(255,0,0,1),
                0 0 20px rgba(255,0,0,0.8),
                0 0 30px rgba(255,0,0,0.6),
                0 0 40px rgba(255,0,0,0.4);
            margin-top: -15px;
            display: block;
        }
        .ampersand {
            text-shadow:
                -6.3px -0.55125px 2px rgba(0,0,0,1),
                0 0 10px rgba(0,0,255,1),
                0 0 20px rgba(0,0,255,0.8),
                0 0 30px rgba(0,0,255,0.6),
                0 0 40px rgba(0,0,255,0.4);
        }
        .upload-container {
            text-align: center;
            color: white;
            position: absolute;
            font-size: 15px;
            bottom: 5px;
            font-family: sans-serif;
        }
        #legalText {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="law-order-container" id="captureArea">
        <div class="law-order-top" contenteditable="true" spellcheck="false" id="topText">LAW</div>
        <span class="ampersand">&</span>
        <div class="law-order-bottom" contenteditable="true" spellcheck="false" id="bottomText">ALSO ORDER</div>
    </div>

    <div class="upload-container" id="uploadContainer">
        <p id="legalText">Made by f4mi.com - For legal reasons, I can't actually ship this distributing the real accurate font used in the title card of the show, but if you already have it (Friz Quadrata), you can click here to load it locally. If the font is already installed on your machine, you should not be seeing this text.</p>
        <input type="file" id="fontUpload" accept=".ttf,.otf" style="display:none">
    </div>

    <!-- Include html2canvas library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        function isFontAvailable(fontName) {
            const testString = 'abcdefghijklmnopqrstuvwxyz0123456789';
            const testSize = '72px';

            const baseFont = 'monospace';
            const testElement = document.createElement('span');
            testElement.style.position = 'absolute';
            testElement.style.left = '-9999px';
            testElement.style.fontSize = testSize;
            testElement.style.fontFamily = baseFont;
            testElement.textContent = testString;
            document.body.appendChild(testElement);

            const baselineWidth = testElement.offsetWidth;
            testElement.style.fontFamily = `'${fontName}', ${baseFont}`;
            const newWidth = testElement.offsetWidth;
            document.body.removeChild(testElement);
            return baselineWidth !== newWidth;
        }

        const fontName = 'Friz Quadrata';
        const uploadedFontDataUrl = localStorage.getItem('uploadedFontDataUrl');

        if (isFontAvailable(fontName)) {
            document.getElementById('uploadContainer').style.display = 'none';
        } else if (uploadedFontDataUrl) {
            const font = new FontFace(fontName, `url(${uploadedFontDataUrl})`);
            font.load().then(loadedFont => {
                document.fonts.add(loadedFont);
                document.body.style.fontFamily = `"${fontName}", serif`;
                document.getElementById('uploadContainer').style.display = 'none';
            }).catch(error => {
                console.error('Failed to load font from localStorage:', error);
            });
        } else {
            document.getElementById('fontUpload').onchange = e => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        const fontDataUrl = e.target.result;
                        try {
                            localStorage.setItem('uploadedFontDataUrl', fontDataUrl);
                        } catch (err) {
                            console.error('Failed to store font in localStorage:', err);
                        }

                        const font = new FontFace(fontName, `url(${fontDataUrl})`);
                        font.load().then(loadedFont => {
                            document.fonts.add(loadedFont);
                            document.body.style.fontFamily = `"${fontName}", serif`;
                            document.getElementById('uploadContainer').style.display = 'none';
                        }).catch(error => {
                            console.error('Failed to load font:', error);
                        });
                    };
                    reader.readAsDataURL(file);
                }
            };

            document.getElementById('legalText').onclick = () => {
                document.getElementById('fontUpload').click();
            };
        }


        const topText = document.getElementById('topText');
        const bottomText = document.getElementById('bottomText');

        window.onload = function() {
            const savedTopText = localStorage.getItem('topText');
            const savedBottomText = localStorage.getItem('bottomText');

            if (savedTopText !== null) {
                topText.textContent = savedTopText;
            }
            if (savedBottomText !== null) {
                bottomText.textContent = savedBottomText;
            }
        };

        function saveTexts() {
            localStorage.setItem('topText', topText.textContent);
            localStorage.setItem('bottomText', bottomText.textContent);
        }

        topText.addEventListener('input', saveTexts);
        bottomText.addEventListener('input', saveTexts);

        function takeScreenshot() {
            const captureArea = document.getElementById('captureArea');

            const originalTransform = captureArea.style.transform;
            const originalTransformOrigin = captureArea.style.transformOrigin;


            const scaleFactor = 2;
            captureArea.style.transform = `scale(${scaleFactor})`;
            captureArea.style.transformOrigin = 'top left';

            html2canvas(captureArea, {
                backgroundColor: null, 
                scale: 1,
                useCORS: true,
            }).then(canvas => {
                captureArea.style.transform = originalTransform;
                captureArea.style.transformOrigin = originalTransformOrigin;

                const link = document.createElement('a');
                link.download = 'screenshot.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(err => {
                console.error('Screenshot capture failed:', err);
                captureArea.style.transform = originalTransform;
                captureArea.style.transformOrigin = originalTransformOrigin;
            });
        }
        document.addEventListener('keydown', function(event) {
            if (event.code === 'ControlRight') {
                event.preventDefault();
                takeScreenshot();
            }
        });
    </script>
</body>
</html>
